<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>WhatsApp Automator</title>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700;900&display=swap');

:root {
    --bg:#f0f0f0;
    --black:#000;
    --white:#fff;
    --green:#25D366;
    --yellow:#FFD600;
    --red:#FF3B30;
    --border:4px;
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:'Public Sans',sans-serif;
}

body{
    background:var(--bg);
    min-height:100vh;
    padding:40px;
    display:flex;
    justify-content:center;
}

.container{
    width:100%;
    max-width:900px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:30px;
}

h1{
    grid-column:1/-1;
    font-size:3rem;
    font-weight:900;
    background:var(--green);
    padding:10px 20px;
    border:var(--border) solid var(--black);
    box-shadow:10px 10px 0 var(--black);
}

.card{
    background:var(--white);
    padding:20px;
    border:var(--border) solid var(--black);
    box-shadow:10px 10px 0 var(--black);
}

label{
    font-weight:900;
    margin-bottom:10px;
    display:block;
}

input, textarea, select{
    width:100%;
    padding:12px;
    border:var(--border) solid var(--black);
    font-weight:800;
    margin-bottom:10px;
}

button{
    padding:15px;
    font-weight:900;
    background:var(--green);
    border:var(--border) solid var(--black);
    cursor:pointer;
    box-shadow:6px 6px 0 var(--black);
}

button:active{
    transform:translate(3px,3px);
    box-shadow:2px 2px 0 var(--black);
}

.status{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:900;
    padding:10px;
    border:var(--border) solid var(--black);
    margin-bottom:15px;
}

.connected{background:var(--green);}
.waiting{background:var(--yellow);}
.disconnected{background:var(--red);}

#qr{
    max-width:100%;
    display:none;
}

.phone-row{
    display:flex;
    gap:10px;
    margin-bottom:10px;
}

.phone-row span{
    padding:12px;
    border:var(--border) solid var(--black);
    background:#ddd;
    font-weight:900;
}

.phone-row button{
    width:50px;
}
</style>
</head>

<body>
<div class="container">

<h1>Timeless Will</h1>

<div class="card">
    <div id="status" class="status disconnected">DISCONNECTED</div>

    <label>WhatsApp QR</label>
    <img id="qr" />
    <div id="qrText">Waiting for QRâ€¦</div>
</div>

<div class="card">
    <label>Contacts</label>
    <div id="contacts"></div>

    <label>Message</label>
    <textarea id="message"></textarea>

    <label>Time</label>
    <input id="hour" type="number" min="1" max="12" placeholder="8">
    <input id="minute" type="number" min="0" max="59" placeholder="00">
    <select id="ampm">
        <option>AM</option>
        <option>PM</option>
    </select>

    <button id="save">Save & Activate</button>
</div>

</div>

<script>
const socket = io("https://message-scheduler-production.up.railway.app", {
    transports:["websocket"],
    withCredentials:true
});

const status = document.getElementById("status");
const qr = document.getElementById("qr");
const qrText = document.getElementById("qrText");
const contactsDiv = document.getElementById("contacts");

function addRow(value="", last=true){
    const row=document.createElement("div");
    row.className="phone-row";
    row.innerHTML=`
        <span>+91</span>
        <input value="${value}">
        <button class="add">+</button>
        <button class="del">X</button>
    `;
    row.querySelector(".add").onclick=()=>{
        row.querySelector(".add").style.display="none";
        addRow("",true);
    };
    row.querySelector(".del").onclick=()=>{
        if(contactsDiv.children.length>1)row.remove();
    };
    if(!last)row.querySelector(".add").style.display="none";
    contactsDiv.appendChild(row);
}

addRow();

socket.on("qr",data=>{
    qr.src=data;
    qr.style.display="block";
    qrText.innerText="Scan QR";
    status.className="status waiting";
    status.innerText="WAITING";
});

socket.on("ready",()=>{
    qr.style.display="none";
    qrText.innerText="Authenticated";
    status.className="status connected";
    status.innerText="CONNECTED";
});

socket.on("config",cfg=>{
    contactsDiv.innerHTML="";
    cfg.contacts.forEach((c,i)=>{
        addRow(c.replace("91","").replace("@c.us",""),i===cfg.contacts.length-1);
    });
    document.getElementById("message").value=cfg.message;
});

document.getElementById("save").onclick=()=>{
    const nums=[...contactsDiv.querySelectorAll("input")]
        .map(i=>i.value.trim())
        .filter(Boolean)
        .map(n=>`91${n}@c.us`);

    let h=parseInt(hour.value)||8;
    let m=parseInt(minute.value)||0;
    if(ampm.value==="PM" && h<12)h+=12;
    if(ampm.value==="AM" && h===12)h=0;

    socket.emit("updateConfig",{
        contacts:nums,
        message:message.value,
        scheduledTime:{hour:h,minute:m}
    });

    alert("Saved");
};
</script>
</body>
</html>
